## Nginx

Nginx выполняет функцию обратного прокси сервера и предоставляет единую точку входа. Все запросы перенаправляются в Next.js приложение. Так достигается изолированность всех остальных компонентов системы от внешнего взаимодействия.

**Кэширование статики**

Статические файлы раздаются по сответствующим маршрутам, начинающихся с `_next/static`. Поскольку эти файлы больше не изменяются, то можно их раздать напрямую через веб-сервер, снижая нагрузку на основной Node-сервер. Все запросы, начинающиеся на `/_next/static/`, перенаправляются на `.next/static` папку, сформированную после сборки приложения.

Для раздачи статических файлов через Nginx:

1. Создается volume `next_static`, далее, в контейнере `next` он монтируется в `/static` директорию. После, этот же volume монтируется в `/usr/share/nginx/html/_next/static` директорю внутри контейнера `nginx`
2. Производится сборка приложения Next.js и статика генерируется в `.next/static` папке
3. После сборки sh-скрипт `static.sh` производит чистку `/static` директории и копирует новые статические файлы в эту же директорию (то есть в volume `next_static`)

Таким образом Ngix раздает актуальные статические файлы.
